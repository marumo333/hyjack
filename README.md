# HyJack - 既存ツールの実現可能性を推定するアプリ（B2B向け）

## プロダクト概要

HyJackは、顧客からの「このアプリでどこまでできるか？」という詳細問合せに対し、**根拠付きで迅速に実現可能性（％）と実装アプローチ**を返すことで、担当者の対応時間を削減し、コア業務へ集中させるB2B向けアプリケーションです。

### 目的・背景
- **目的**: 顧客からの詳細問合せに対し、根拠付きで迅速に実現可能性（％）と実装アプローチを返す
- **背景**: B2B企業で製品・アプリの問い合わせが頻発し、社内の仕様書・要件定義・FAQ・導入事例など**100件以上のWord文書**を参照する必要がある
- **課題**: 回答のばらつきとリードタイム、社外提示可能な表現・根拠の線引きが困難

### 解決策
- **RAG（Retrieval-Augmented Generation）**で社内文書から根拠を抽出
- **実現可能性スコア**と**推奨アプローチ**を自動生成
- **証拠リンク/抜粋**を並記し、人がすぐレビュー・編集
- **禁止/制約ルール**を判定に組み込み、誤約束を防ぐ

### 成功指標（北極星KPI）
- 問い合わせ→一次回答までの**中央値5分以内**
- **根拠提示率90%**
- 人手判定の**実用精度≥70%**

---

## 技術スタック

### アーキテクチャ
- **フロントエンド**: Next.js + TypeScript + React
- **バックエンド**: Laravel (PHP) API
- **AI**: Gemini API（埋め込みモデル + 生成モデル）
- **ストレージ**: PostgreSQL + pgvector（埋め込み）, S3互換（原本）
- **認証**: NextAuth.js / Auth0 / Laravel Sanctum
- **監査**: 永続ログ（質問, 返答, 参照ID, モデルver, プロンプトver）
- **キュー**: Redis + Laravel Queue

### データフロー
1. .docxアップロード → 抽出（段落/表） → チャンク分割(500-1000字) → 埋め込み → ベクトル格納
2. 質問受領 → 類似検索(top-k) → ルール判定 → 生成モデルで回答/スコア → UI表示

---

## タスク管理基準

### 優先度（Priority）
- **prio:P0** - 最優先・ブロッカー  
  これが終わらないとプロジェクト全体が進まない。必ず最初に着手する。期限が迫っているクリティカルタスク。
- **prio:P1** - 高優先度  
  ユーザーにとって重要 or 事業上のインパクト大。できれば今スプリント内に実装すべき。
- **prio:P2** - 中優先度  
  やった方がいいが、P0/P1の後回しでOK。余裕があれば対応する。
- **prio:P3** - 低優先度  
  Nice-to-have（あったら良い機能）。リリース後に改善でも良い。優先順位付けで一番後。

### 工数規模（Size）
- **size:S** - 軽いタスク（すぐ終わる）
- **size:M** - 数日のまとまった作業
- **size:L** - 1スプリント規模の作業
- **size:XL** - スプリントを超える。PoCフェーズでは基本避けたい

---

## 開発マイルストーン

### M1: 基盤とRAG最小実装（Week 1）
**目的**: 文書→索引→RAG回答の最短経路を通す  
**DoD**: .docx→抽出→分割→埋め込み→検索→引用付き回答が通る

#### M1のP0（この2週間PoCで必須）
- [M1][P0][BE/AI] Word文書の抽出・構造化（.docx）
- [M1][P0][BE] チャンク分割とメタデータ付与
- [M1][P0][AI/BE] 埋め込み生成とpgvector格納
- [M1][P0][BE] 類似検索API（Top-K）
- [M1][P0][AI] RAG回答生成（引用付き）
- [M1][P0][FE] 回答画面（骨組み）
- [M1][P0][AI] 実現可能性スコア算出 v0（式）
- [M1][P0][AI] ルール/禁止語ガードレール
- [M1][P0][BE] 監査ログ（入出力/参照ID/モデルver）
- [M1][P0][BE] キュー基盤（Redis + Laravel Queue）
- [M1][P0][BE] 原本ストレージ（S3互換）+ 版管理

#### M1のP1（余裕があれば入れるが最悪なくてもPoC成立）
- [M1][P1][BE] インジェストのエラーハンドリング/再試行

---

### M2: スコア/UI/評価/運用（Week 2）
**目的**: 実現可能性スコア/運用/評価を実装しパイロット可能に  
**DoD**: ％表示・ダッシュボード・評価50件・パイロット運用開始

#### M2のP0（2週目に必ず必要・パイロット条件）
- [M2][P0][AI] 期間レンジ推定（実装目安）
- [M2][P0][AI] 推奨アプローチ生成（ステップ化）
- [M2][P0][FE] 回答UI 完成（スコア/ラベル/期間/根拠ハイライト）
- [M2][P0][DATA] 評価データ作成（50件）& ラベリング運用
- [M2][P0][BE] 評価ダッシュボード（精度/根拠率/応答時間）
- [M2][P0][BE] レート制御/キャッシュ（無料枠対策）
- [M2][P0][SEC] セキュリティ/コンプラ初期（PII/テナント境界）
- [M2][P0][OPS] パイロット運用（社内10–15名）
- [M2][P0][AI] プロンプト雛形（社内/顧客向け）

#### M2のP1（あれば便利、完成度を上げる）
- [M2][P1][FE] 文書管理UI（履歴/有効化/再インデックス）
- [M2][P1][OPS] 再インデックス運用手順（版管理/失効）
- [M2][P1][BE] 非機能チューニング（P95≤8秒）
- [M2][P1][DOC] ドキュメント（README/利用ガイド/FAQ）

---

## 実現可能性スコア算出

### 出力項目
- `score_pct (0-100)`: 実現可能性パーセンテージ
- `band (High/Med/Low)`: 信頼度バンド
- `label (対応/要カスタム/非対応)`: 分類ラベル
- `rationale`: 根拠説明

### 算出要素
- **E1: 根拠カバレッジ**（該当セクション数/必要観点）
- **E2: ルール整合**（禁止/制約/サポートの一致度）
- **E3: 複雑度逆数**（必要コンポーネント数、依存、未知API）
- **E4: 類似成功事例の有無**（ナレッジ/FAQでの成功ケース）
- **P: 罰則**（根拠年代が古い、矛盾、OOS検知）

### 計算式
```
score = clamp( w1*E1 + w2*E2 + w3*E3 + w4*E4 - P , 0, 100 )
```
初期重み: w1=0.35, w2=0.25, w3=0.20, w4=0.20

---

## 起動コマンド

### フロントエンド（Next.js）
```bash
cd frontend
npm install
npm run dev
# または
yarn install
yarn dev
```

### バックエンド（Laravel）
```bash
cd backend
cp .env.example .env
./vendor/bin/sail up -d
./vendor/bin/sail artisan migrate
```

### アクセスURL
- フロントエンド: http://localhost:3000
- バックエンドAPI: http://localhost:8000/api

---

## 非機能要件

### 性能
- 問合せ→初回回答 **≤ 8秒**（P95, 参考: 1,500トークン級）

### 可用性
- 平日9-19時SLA 99.5%

### セキュリティ
- テナント分離、PII最小化、転送/保存時暗号化
- **アップロード禁止語/外部秘フラグ**検出

### 監査性
- 入出力ログ、参照根拠、モデル/プロンプトバージョンの記録

---

## 主要ユーザーストーリー

1. **CSとして**、顧客要望を1文で投げると、**可否％と根拠**が3つ以内で返る
2. **セールスとして**、**非対応/要カスタム**の場合は**代替案**と**期待効果**が返る
3. **PMとして**、回答に使われた**根拠文書のバージョン/日付**を確認できる

---

## 画面設計

- **ホーム**: 入力テキスト、過去質問、ドラフト回答一覧
- **回答画面**: ①可否％ + ラベル（対応/要カスタム/非対応）②根拠（ハイライト付）③推奨アプローチ（箇条書き）④期間レンジ ⑤リスク注意
- **文書管理**: アップロード履歴、インデックス状態、バージョン/有効・無効

---

## 検証計画（PoC 2週間）

### 対象
- 社内ユーザー10-15名、問い合わせ50件以上

### KPI
- 実用精度（人手合意ラベルと一致率）≥70%
- 根拠提示率≥90%
- 初回応答時間P95 ≤ 8秒
- 人手対応時間の短縮 ≥50%

### 方法
A/Bで現行/新ツールの応答速度と訂正率を比較。誤回答はタグ付けして再学習（重み更新）。

---

## リスクと対策

- **幻覚/誤約束**: 根拠未満時は**保留**を返す。社外向けテンプレで確度ラベル必須
- **無料枠制限**: レート/トークン制限→**キュー/キャッシュ/要約**で回避。将来有料枠や代替APIに切替可能な**抽象化レイヤ**
- **機密情報**: マスキング/PII検出、外部送信ポリシーの同意、利用規約/監査
- **文書鮮度**: 版管理/失効日、再インデックスの運用手順

---

## Definition of Done（PoC）

- 代表的な問い合わせ50件で**実用精度≥70%**、根拠提示率≥90%
- P95応答≤8秒、監査ログと再現性確保（プロンプト/モデルver記録）
- 利用者満足（CS/セールスのNPS≥+20）

---

## 参考リンク

- [PRD.md](./PRD.md) - プロダクト要件定義書
- [Backlog.md](./Backlog.md) - 開発バックログ（詳細）
- [frontend/README.md](./frontend/README.md) - フロントエンド詳細
- [backend/README.md](./backend/README.md) - バックエンド詳細
